generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                     String            @id @default(cuid())
  email                  String?           @unique
  username               String            @unique
  password               String?
  fullName               String?
  avatar                 String?
  bio                    String?
  coverImage             String?
  isVerified             Boolean           @default(false)
  createdAt              DateTime          @default(now())
  updatedAt              DateTime          @updatedAt
  dateOfBirth            DateTime?
  originCity             String?
  currentCity            String?
  schoolName             String?
  collegeName            String?
  highSchoolName         String?
  universityName         String?
  collegeInfo            Json?
  highSchoolInfo         Json?
  universityInfo         Json?
  skills                 String?
  pseudonym              String?
  mobileContact          String?
  familyRelations        String?
  googleId               String?           @unique
  facebookId             String?           @unique
  resetToken             String?           @unique
  resetTokenExpiry       DateTime?
  theme                  String            @default("auto")
  resetCode              String?
  resetCodeExpiry        DateTime?
  verificationCode       String?
  verificationCodeExpiry DateTime?
  accounts               Account[]
  adminMessages          AdminMessage[]
  bookmarks              Bookmark[]
  callParticipants       CallParticipant[]
  commentReactions       CommentReaction[]
  comments               Comment[]
  friends1               Friendship[]      @relation("User1")
  friends2               Friendship[]      @relation("User2")
  groupMembers           GroupMember[]
  groupPollsCreated      GroupPoll[]       @relation("GroupPollCreator")
  likes                  Like[]
  loginHistory           LoginHistory[]
  messageReactions       MessageReaction[]
  receivedMessages       Message[]         @relation("ReceivedMessages")
  messages               Message[]         @relation("SentMessages")
  notifications          Notification[]
  pageAdmins             PageAdmin[]
  pageInvites            PageInvite[]
  pageMembers            PageMember[]
  pagePollsCreated       PagePoll[]        @relation("PagePollCreator")
  photoGallery           PhotoGallery[]
  pollVotes              PollVote[]
  postReports            PostReport[]      @relation("PostReports")
  posts                  Post[]
  reactions              Reaction[]
  savedDevices           SavedDevice[]
  sessions               Session[]
  stories                Story[]
  storyReactions         StoryReaction[]
  storyViews             StoryView[]
  callerCalls            VideoCall[]       @relation("CallerCalls")
  recipientCalls         VideoCall[]       @relation("RecipientCalls")

  @@map("users")
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@map("accounts")
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
  @@map("verification_tokens")
}

model PostMedia {
  id        String   @id @default(cuid())
  postId    String
  type      String
  url       String
  createdAt DateTime @default(now())
  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@index([postId])
  @@map("post_media")
}

model Post {
  id             String       @id @default(cuid())
  content        String
  background     String?
  userId         String
  sharedPostId   String?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  isDeleted      Boolean      @default(false)
  styling        Json?
  isPublic       Boolean      @default(false)
  bookmarks      Bookmark[]
  comments       Comment[]
  likes          Like[]
  media          PostMedia[]
  reports        PostReport[]
  sharedPost     Post?        @relation("SharedPost", fields: [sharedPostId], references: [id])
  shares         Post[]       @relation("SharedPost")
  user           User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  reactions      Reaction[]
  shareRelations Share[]

  @@index([userId])
  @@index([createdAt])
  @@map("posts")
}

model PostReport {
  id         String   @id @default(cuid())
  postId     String
  reporterId String
  reason     String
  status     String   @default("pending")
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  post       Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  reporter   User     @relation("PostReports", fields: [reporterId], references: [id], onDelete: Cascade)

  @@unique([postId, reporterId])
  @@index([postId])
  @@index([reporterId])
  @@index([status])
  @@map("post_reports")
}

model Comment {
  id        String            @id @default(cuid())
  content   String
  postId    String
  userId    String
  parentId  String?
  createdAt DateTime          @default(now())
  updatedAt DateTime          @updatedAt
  reactions CommentReaction[]
  parent    Comment?          @relation("CommentReplies", fields: [parentId], references: [id], onDelete: Cascade)
  replies   Comment[]         @relation("CommentReplies")
  post      Post              @relation(fields: [postId], references: [id], onDelete: Cascade)
  user      User              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([postId])
  @@index([userId])
  @@map("comments")
}

model Like {
  id        String   @id @default(cuid())
  postId    String
  userId    String
  createdAt DateTime @default(now())
  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([postId, userId])
  @@index([postId])
  @@index([userId])
  @@map("likes")
}

model Share {
  id        String   @id @default(cuid())
  postId    String
  userId    String
  createdAt DateTime @default(now())
  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@index([postId])
  @@index([userId])
  @@map("shares")
}

model Reaction {
  id        String   @id @default(cuid())
  emoji     String
  postId    String?
  commentId String?
  userId    String
  createdAt DateTime @default(now())
  post      Post?    @relation(fields: [postId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([postId])
  @@index([commentId])
  @@index([userId])
  @@map("reactions")
}

model Story {
  id         String          @id @default(cuid())
  imageUrl   String?
  videoUrl   String?
  text       String?
  background String?
  userId     String
  expiresAt  DateTime
  createdAt  DateTime        @default(now())
  user       User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  reactions  StoryReaction[]
  views      StoryView[]

  @@index([userId])
  @@index([expiresAt])
  @@map("stories")
}

model StoryView {
  id       String   @id @default(cuid())
  storyId  String
  userId   String
  viewedAt DateTime @default(now())
  story    Story    @relation(fields: [storyId], references: [id], onDelete: Cascade)
  user     User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([storyId, userId])
  @@index([storyId])
  @@map("story_views")
}

model StoryReaction {
  id        String   @id @default(cuid())
  emoji     String
  storyId   String
  userId    String
  createdAt DateTime @default(now())
  story     Story    @relation(fields: [storyId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([storyId, userId])
  @@index([storyId])
  @@map("story_reactions")
}

model Message {
  id         String            @id @default(cuid())
  content    String
  image      String?
  document   String?
  senderId   String
  receiverId String
  isRead     Boolean           @default(false)
  readAt     DateTime?
  createdAt  DateTime          @default(now())
  reactions  MessageReaction[]
  receiver   User              @relation("ReceivedMessages", fields: [receiverId], references: [id], onDelete: Cascade)
  sender     User              @relation("SentMessages", fields: [senderId], references: [id], onDelete: Cascade)

  @@index([senderId])
  @@index([receiverId])
  @@index([createdAt])
  @@map("messages")
}

model MessageReaction {
  id        String   @id @default(cuid())
  emoji     String
  messageId String
  userId    String
  createdAt DateTime @default(now())
  message   Message  @relation(fields: [messageId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([messageId, userId])
  @@index([messageId])
  @@map("message_reactions")
}

model Notification {
  id        String   @id @default(cuid())
  type      String
  title     String
  content   String?
  url       String?
  userId    String
  actorId   String
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([createdAt])
  @@map("notifications")
}

model Friendship {
  id        String   @id @default(cuid())
  user1Id   String
  user2Id   String
  status    String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user1     User     @relation("User1", fields: [user1Id], references: [id], onDelete: Cascade)
  user2     User     @relation("User2", fields: [user2Id], references: [id], onDelete: Cascade)

  @@unique([user1Id, user2Id])
  @@index([user1Id])
  @@index([user2Id])
  @@map("friendships")
}

model Group {
  id            String         @id @default(cuid())
  name          String
  description   String?
  image         String?
  adminId       String
  isPrivate     Boolean        @default(false)
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  profileImage  String?
  visibility    String         @default("public")
  adminMessages AdminMessage[]
  members       GroupMember[]
  polls         GroupPoll[]
  posts         GroupPost[]

  @@index([adminId])
  @@map("groups")
}

model GroupMember {
  id       String   @id @default(cuid())
  groupId  String
  userId   String
  role     String   @default("member")
  joinedAt DateTime @default(now())
  group    Group    @relation(fields: [groupId], references: [id], onDelete: Cascade)
  user     User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([groupId, userId])
  @@index([groupId])
  @@index([userId])
  @@map("group_members")
}

model GroupPostMedia {
  id        String    @id @default(cuid())
  postId    String
  type      String
  url       String
  createdAt DateTime  @default(now())
  post      GroupPost @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@index([postId])
  @@map("group_post_media")
}

model GroupPost {
  id        String           @id @default(cuid())
  content   String
  groupId   String
  authorId  String
  createdAt DateTime         @default(now())
  media     GroupPostMedia[]
  group     Group            @relation(fields: [groupId], references: [id], onDelete: Cascade)

  @@index([groupId])
  @@index([authorId])
  @@map("group_posts")
}

model Page {
  id            String         @id @default(cuid())
  name          String
  description   String?
  category      String?
  image         String?
  coverImage    String?
  isVerified    Boolean        @default(false)
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  profileImage  String?
  visibility    String         @default("public")
  adminMessages AdminMessage[]
  admins        PageAdmin[]
  invites       PageInvite[]
  members       PageMember[]
  polls         PagePoll[]
  posts         PagePost[]

  @@map("pages")
}

model PageMember {
  id       String   @id @default(cuid())
  pageId   String
  userId   String
  role     String   @default("member")
  joinedAt DateTime @default(now())
  page     Page     @relation(fields: [pageId], references: [id], onDelete: Cascade)
  user     User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([pageId, userId])
  @@index([pageId])
  @@index([userId])
  @@map("page_members")
}

model PageInvite {
  id        String   @id @default(cuid())
  pageId    String
  userId    String
  invitedBy String
  status    String   @default("pending")
  createdAt DateTime @default(now())
  page      Page     @relation(fields: [pageId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([pageId, userId])
  @@index([pageId])
  @@index([userId])
  @@map("page_invites")
}

model PageAdmin {
  id         String   @id @default(cuid())
  pageId     String
  userId     String
  role       String   @default("admin")
  assignedAt DateTime @default(now())
  page       Page     @relation(fields: [pageId], references: [id], onDelete: Cascade)
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([pageId, userId])
  @@index([pageId])
  @@index([userId])
  @@map("page_admins")
}

model PagePostMedia {
  id        String   @id @default(cuid())
  postId    String
  type      String
  url       String
  createdAt DateTime @default(now())
  post      PagePost @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@index([postId])
  @@map("page_post_media")
}

model PagePost {
  id        String          @id @default(cuid())
  content   String
  pageId    String
  authorId  String
  createdAt DateTime        @default(now())
  media     PagePostMedia[]
  page      Page            @relation(fields: [pageId], references: [id], onDelete: Cascade)

  @@index([pageId])
  @@index([authorId])
  @@map("page_posts")
}

model PhotoGallery {
  id        String   @id @default(cuid())
  userId    String
  url       String
  type      String
  caption   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([type])
  @@map("photo_gallery")
}

model Bookmark {
  id        String   @id @default(cuid())
  userId    String
  postId    String
  createdAt DateTime @default(now())
  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, postId])
  @@index([userId])
  @@index([postId])
  @@map("bookmarks")
}

model LoginHistory {
  id        String   @id @default(cuid())
  userId    String
  email     String
  loginAt   DateTime @default(now())
  userAgent String?
  ipAddress String?
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([email])
  @@index([loginAt])
  @@map("login_history")
}

model SavedDevice {
  id         String   @id @default(cuid())
  userId     String
  deviceName String?
  userAgent  String?
  ipAddress  String?
  createdAt  DateTime @default(now())
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([createdAt])
  @@map("saved_devices")
}

model CommentReaction {
  id        String   @id @default(cuid())
  commentId String
  userId    String
  emoji     String
  createdAt DateTime @default(now())
  comment   Comment  @relation(fields: [commentId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, commentId])
  @@index([commentId])
  @@index([userId])
  @@map("comment_reactions")
}

model SponsoredPost {
  id          String   @id @default(cuid())
  title       String
  description String
  content     String
  image       String?
  link        String?
  advertiser  String
  budget      Float
  spent       Float    @default(0)
  impressions Int      @default(0)
  clicks      Int      @default(0)
  conversions Int      @default(0)
  status      String   @default("active")
  startDate   DateTime
  endDate     DateTime
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([status])
  @@index([startDate])
  @@index([endDate])
  @@map("sponsored_posts")
}

model VideoCall {
  id          String    @id @default(cuid())
  callerId    String
  recipientId String
  status      String    @default("pending")
  startedAt   DateTime?
  endedAt     DateTime?
  duration    Int       @default(0)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  caller      User      @relation("CallerCalls", fields: [callerId], references: [id], onDelete: Cascade)
  recipient   User      @relation("RecipientCalls", fields: [recipientId], references: [id], onDelete: Cascade)

  @@unique([callerId, recipientId, createdAt])
  @@index([callerId])
  @@index([recipientId])
  @@index([status])
  @@map("video_calls")
}

model CallParticipant {
  id          String    @id @default(cuid())
  videoCallId String?
  userId      String
  joinedAt    DateTime  @default(now())
  leftAt      DateTime?
  createdAt   DateTime  @default(now())
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("call_participants")
}

model PagePoll {
  id            String       @id @default(cuid())
  pageId        String
  createdBy     String
  question      String
  description   String?
  status        String       @default("active")
  allowMultiple Boolean      @default(false)
  createdAt     DateTime     @default(now())
  closedAt      DateTime?
  creator       User         @relation("PagePollCreator", fields: [createdBy], references: [id], onDelete: Cascade)
  page          Page         @relation(fields: [pageId], references: [id], onDelete: Cascade)
  options       PollOption[]
  votes         PollVote[]

  @@index([pageId])
  @@index([createdBy])
  @@map("page_polls")
}

model GroupPoll {
  id            String       @id @default(cuid())
  groupId       String
  createdBy     String
  question      String
  description   String?
  status        String       @default("active")
  allowMultiple Boolean      @default(false)
  createdAt     DateTime     @default(now())
  closedAt      DateTime?
  creator       User         @relation("GroupPollCreator", fields: [createdBy], references: [id], onDelete: Cascade)
  group         Group        @relation(fields: [groupId], references: [id], onDelete: Cascade)
  options       PollOption[]
  votes         PollVote[]

  @@index([groupId])
  @@index([createdBy])
  @@map("group_polls")
}

model PollOption {
  id          String     @id @default(cuid())
  pagePoolId  String?
  groupPoolId String?
  text        String
  voteCount   Int        @default(0)
  createdAt   DateTime   @default(now())
  groupPoll   GroupPoll? @relation(fields: [groupPoolId], references: [id], onDelete: Cascade)
  pagePoll    PagePoll?  @relation(fields: [pagePoolId], references: [id], onDelete: Cascade)
  votes       PollVote[]

  @@index([pagePoolId])
  @@index([groupPoolId])
  @@map("poll_options")
}

model PollVote {
  id          String     @id @default(cuid())
  pagePoolId  String?
  groupPoolId String?
  optionId    String
  userId      String
  createdAt   DateTime   @default(now())
  groupPoll   GroupPoll? @relation(fields: [groupPoolId], references: [id], onDelete: Cascade)
  option      PollOption @relation(fields: [optionId], references: [id], onDelete: Cascade)
  pagePoll    PagePoll?  @relation(fields: [pagePoolId], references: [id], onDelete: Cascade)
  user        User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([optionId, userId])
  @@index([userId])
  @@map("poll_votes")
}

model AdminMessage {
  id        String    @id @default(cuid())
  pageId    String?
  groupId   String?
  senderId  String
  subject   String
  content   String
  status    String    @default("unread")
  createdAt DateTime  @default(now())
  repliedAt DateTime?
  group     Group?    @relation(fields: [groupId], references: [id], onDelete: Cascade)
  page      Page?     @relation(fields: [pageId], references: [id], onDelete: Cascade)
  sender    User      @relation(fields: [senderId], references: [id], onDelete: Cascade)

  @@index([pageId])
  @@index([groupId])
  @@index([senderId])
  @@index([status])
  @@map("admin_messages")
}
